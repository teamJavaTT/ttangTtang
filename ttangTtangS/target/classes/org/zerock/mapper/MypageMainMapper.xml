<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.MypageMainMapper">

	<select id="selectAccountDeclaration"
		resultType="org.zerock.domain.AccountDeclaration">
		<![CDATA[
		select * 
		from declaration 
		order by dno desc
		]]>
	</select>

	<select id="selectBlockUser"
		resultType="org.zerock.domain.BlockUser">
		<![CDATA[
		select * 
		from block 
		order by bno desc
		]]>
	</select>

	<select id="selectLikeProduct"
		resultType="org.zerock.domain.Product" parameterType="map">
		<![CDATA[
		select * from 
		(select row_number() over (order by ino desc) num, A.* from product A where ino in (
         select ino 
         from likeproduct 
         where userid=#{userid}
      ) order by ino desc) 
		where num between #{pageStart} and #{pageEnd}
		]]>
	</select>
	
	<select id="selectLikeProductListCount" resultType="int">
		<![CDATA[
		select count(ino) from likeproduct where ino > 0
		]]>
	</select>

	<select id="selectSellList"
		resultType="org.zerock.domain.Product" parameterType="map">
		<![CDATA[
		select * from 
		(select row_number() over (order by ino desc) num, A.* from product A where ino in (
         select ino 
         from product 
         where userid=#{userid}
         ]]>
		<if test='!sellchk.equals("A")'>
			and sellcheck=#{sellchk}
		</if>
		<![CDATA[
      ) order by ino desc) 
		where num between #{pageStart} and #{pageEnd}
		]]>
	</select>

	<select id="selectSellListCount" resultType="int">
		<![CDATA[
		select count(ino) 
		from product 
		where userid=#{userid} 
		]]>
		<if test='!sellchk.equals("A")'>
			and sellcheck=#{sellchk}
		</if>
		<![CDATA[
		and ino > 0
		]]>
	</select>

	<select id="selectDeleteForm"
		resultType="org.zerock.domain.Secession">
		<![CDATA[
		select * 
		from Secession 
		order by sno desc
		]]>
	</select>

	<insert id="insertAccountDeclaration">
		insert into declaration values
		(declaration_seq.nextval, #{userId}, #{declId}, #{dtext}, sysdate)
		where num between #{pageStart} and #{pageEnd}
	</insert>

	<select id="selectCountDec" parameterType="map" resultType="int">
		<![CDATA[
		select count(*) from declaration where userid=#{userid} and duid=#{badid}
		where num between #{pageStart} and #{pageEnd}
		]]>
	</select>

	<insert id="insertBlockUser">
		insert into block values
		(block_seq.nextval,
		#{userId}, #{blockid2}, #{btext}, sysdate)
	</insert>

	<select id="selectCountBl" parameterType="map" resultType="int">
		<![CDATA[
		select count(*) from block where userid=#{userid} and bid=#{blockid}
		where num between #{pageStart} and #{pageEnd}
		]]>
	</select>
	
	<select id="alimAllSelect" resultType="org.zerock.domain.Alim">
		select * 
		from alim 
		where userid = #{userid} 
		order by lno desc
	</select>
	
	<update id="alimChkUpdate">
		update alim 
		set alimchk = 'Y' 
		where alimchk = 'N' 
		and userid = #{userid}
	</update>

</mapper>
